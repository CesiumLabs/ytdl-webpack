/*! For license information please see ytdl-core.min.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports["ytdl-core"]=t():e["ytdl-core"]=t()}(global,(function(){return e={292:function(e,t,a){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=a(781),s=r(a(99)),o=a(909);class n extends i.Writable{constructor(e){let t;super(),this._parser=s.default.createStream(!1,{lowercase:!0}),this._parser.on("error",this.destroy.bind(this));let a,r,i,n,l,c,u,d,p=0,m=0,h=[],b=!1,f=!1;const g=t=>{const a={RepresentationID:e,Number:m,Time:p};return t.replace(/\$(\w+)\$/g,((e,t)=>`${a[t]}`))};this._parser.on("opentag",(s=>{switch(s.name){case"mpd":p=s.attributes.availabilitystarttime?new Date(s.attributes.availabilitystarttime).getTime():0,c="dynamic"!==s.attributes.type;break;case"period":m=0,r=1e3,n=0,i=0,l=[],u=0,d=o.durationStr(s.attributes.start)||0;break;case"segmentlist":m=parseInt(s.attributes.startnumber)||m,r=parseInt(s.attributes.timescale)||r,n=parseInt(s.attributes.duration)||n,i=parseInt(s.attributes.presentationtimeoffset)||i;break;case"segmenttemplate":a=s.attributes,m=parseInt(s.attributes.startnumber)||m,r=parseInt(s.attributes.timescale)||r;break;case"segmenttimeline":case"baseurl":t=s.name;break;case"s":h.push({duration:parseInt(s.attributes.d),repeat:parseInt(s.attributes.r),time:parseInt(s.attributes.t)});break;case"adaptationset":case"representation":u++,e||(e=s.attributes.id),b=s.attributes.id===`${e}`,b&&(d&&(p+=d),i&&(p-=i/r*1e3),this.emit("starttime",p));break;case"initialization":b&&this.emit("item",{url:l.filter((e=>!!e)).join("")+s.attributes.sourceurl,seq:m,init:!0,duration:0});break;case"segmenturl":if(b){f=!0;let e=h.shift(),t=((null==e?void 0:e.duration)||n)/r*1e3;this.emit("item",{url:l.filter((e=>!!e)).join("")+s.attributes.media,seq:m++,duration:t}),p+=t}}}));const y=()=>{c&&this.emit("endlist"),b?this.emit("end"):this.destroy(Error(`Representation '${e}' not found`))};this._parser.on("closetag",(e=>{switch(e){case"adaptationset":case"representation":if(u--,a&&h.length){f=!0,a.initialization&&this.emit("item",{url:l.filter((e=>!!e)).join("")+g(a.initialization),seq:m,init:!0,duration:0});for(let{duration:e,repeat:t,time:i}of h){e=e/r*1e3,t=t||1,p=i||p;for(let r=0;r<t;r++)this.emit("item",{url:l.filter((e=>!!e)).join("")+g(a.media),seq:m++,duration:e}),p+=e}}f&&(this.emit("endearly"),y(),this._parser.removeAllListeners(),this.removeAllListeners("finish"))}})),this._parser.on("text",(e=>{"baseurl"===t&&(l[u]=e,t=null)})),this.on("finish",y)}_write(e,t,a){this._parser.write(e,t),a()}}t.default=n},599:function(e,t,a){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};const i=a(781),s=r(a(780)),o=r(a(839)),n=r(a(292)),l=a(589),c=a(909),u={m3u8:o.default,"dash-mpd":n.default};let d=(e,t={})=>{const a=new i.PassThrough,r=t.chunkReadahead||3,o=t.liveBuffer||2e4,n=t.requestOptions,d=u[t.parser||(/\.mpd$/.test(e)?"dash-mpd":"m3u8")];if(!d)throw TypeError(`parser '${t.parser}' not supported`);let p=0;void 0!==t.begin&&(p="string"==typeof t.begin?c.humanStr(t.begin):Math.max(t.begin-o,0));const m=e=>{for(let t of["abort","request","response","redirect","retry","reconnect"])e.on(t,a.emit.bind(a,t))};let h;const b=new l.Queue(((e,t)=>{h=e;let r=0;e.on("data",(e=>r+=e.length)),e.pipe(a,{end:!1}),e.on("end",(()=>t(null,r)))}),{concurrency:1});let f=0,g=0;const y=new l.Queue(((t,r)=>{let i=Object.assign({},n);t.range&&(i.headers=Object.assign({},i.headers,{Range:`bytes=${t.range.start}-${t.range.end}`}));let o=s.default(new URL(t.url,e).toString(),i);o.on("error",r),m(o),b.push(o,((e,i)=>{g+=+i,a.emit("progress",{num:++f,size:i,duration:t.duration,url:t.url},y.total,g),r(null)}))}),{concurrency:r}),T=e=>{R||(a.emit("error",e),a.end())};let E,_,v,w,I=!0,R=!1,D=!1;const A=e=>{if(h=null,e)T(e);else if(!I&&!R&&!D&&y.tasks.length+y.active<=E){let e=Math.max(0,_-(Date.now()-w));I=!0,v=setTimeout(O,e)}else!R&&!D||y.tasks.length||y.active||a.end()};let N,L,x=0;const O=()=>{w=Date.now(),N=s.default(e,n),N.on("error",T),m(N);const a=N.pipe(new d(t.id));a.on("starttime",(e=>{x||(x=e,"string"==typeof t.begin&&p>=0&&(p+=x))})),a.on("endlist",(()=>{D=!0})),a.on("endearly",N.unpipe.bind(N,a));let r=[];const i=e=>{if(!e.init){if(e.seq<=L)return;L=e.seq}p=e.time,y.push(e,A),r.push(e)};let l=[],c=0;a.on("item",(e=>{let t=Object.assign({time:x},e);if(p<=t.time)i(t);else for(l.push(t),c+=t.duration;l.length>1&&c-l[0].duration>o;){const e=l.shift();c-=e.duration}x+=t.duration})),a.on("end",(()=>{N=null,!r.length&&l.length&&l.forEach((e=>{i(e)})),E=Math.max(1,Math.ceil(.01*r.length)),_=r.reduce(((e,t)=>t.duration+e),0),I=!1,A(null)}))};return O(),a.end=()=>{R=!0,b.die(),y.die(),clearTimeout(v),null==N||N.destroy(),null==h||h.destroy(),i.PassThrough.prototype.end.call(a,null)},a};d.parseTimestamp=c.humanStr,e.exports=d},839:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=a(781);class i extends r.Writable{constructor(){super(),this._lastLine="",this._seq=0,this._nextItemDuration=null,this._nextItemRange=null,this._lastItemRangeEnd=0,this.on("finish",(()=>{this._parseLine(this._lastLine),this.emit("end")}))}_parseAttrList(e){let t,a={},r=/([A-Z0-9-]+)=(?:"([^"]*?)"|([^,]*?))/g;for(;null!==(t=r.exec(e));)a[t[1]]=t[2]||t[3];return a}_parseRange(e){if(!e)return null;let t=e.split("@"),a=t[1]?parseInt(t[1]):this._lastItemRangeEnd+1,r={start:a,end:a+parseInt(t[0])-1};return this._lastItemRangeEnd=r.end,r}_parseLine(e){let t=e.match(/^#(EXT[A-Z0-9-]+)(?::(.*))?/);if(t){const e=t[1],a=t[2]||"";switch(e){case"EXT-X-PROGRAM-DATE-TIME":this.emit("starttime",new Date(a).getTime());break;case"EXT-X-MEDIA-SEQUENCE":this._seq=parseInt(a);break;case"EXT-X-MAP":{let e=this._parseAttrList(a);if(!e.URI)return void this.destroy(new Error("`EXT-X-MAP` found without required attribute `URI`"));this.emit("item",{url:e.URI,seq:this._seq,init:!0,duration:0,range:this._parseRange(e.BYTERANGE)});break}case"EXT-X-BYTERANGE":this._nextItemRange=this._parseRange(a);break;case"EXTINF":this._nextItemDuration=Math.round(1e3*parseFloat(a.split(",")[0]));break;case"EXT-X-ENDLIST":this.emit("endlist")}}else!/^#/.test(e)&&e.trim()&&(this.emit("item",{url:e.trim(),seq:this._seq++,duration:this._nextItemDuration,range:this._nextItemRange}),this._nextItemRange=null)}_write(e,t,a){let r=e.toString("utf8").split("\n");this._lastLine&&(r[0]=this._lastLine+r[0]),r.forEach(((e,t)=>{this.destroyed||(t<r.length-1?this._parseLine(e):this._lastLine=e)})),a()}}t.default=i},909:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.durationStr=t.humanStr=void 0;const a=/^\d+$/,r=/^(?:(?:(\d+):)?(\d{1,2}):)?(\d{1,2})(?:\.(\d{3}))?$/,i={ms:1,s:1e3,m:6e4,h:36e5};t.humanStr=e=>{if("number"==typeof e)return e;if(a.test(e))return+e;const t=r.exec(e);if(t)return+(t[1]||0)*i.h+ +(t[2]||0)*i.m+ +t[3]*i.s+ +(t[4]||0);{let t=0;const a=/(-?\d+)(ms|s|m|h)/g;let r;for(;null!==(r=a.exec(e));)t+=+r[1]*i[r[2]];return t}},t.durationStr=e=>{let t=0;const a=/(\d+(?:\.\d+)?)(S|M|H)/g;let r;for(;null!==(r=a.exec(e));)t+=+r[1]*i[r[2].toLowerCase()];return t}},589:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Queue=void 0,t.Queue=class{constructor(e,t={}){this._worker=e,this._concurrency=t.concurrency||1,this.tasks=[],this.total=0,this.active=0}push(e,t){this.tasks.push({item:e,callback:t}),this.total++,this._next()}_next(){if(this.active>=this._concurrency||!this.tasks.length)return;const{item:e,callback:t}=this.tasks.shift();let a=!1;this.active++,this._worker(e,((e,r)=>{a||(this.active--,a=!0,null==t||t(e,r),this._next())}))}die(){this.tasks=[]}}},780:function(e,t,a){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};const i=r(a(685)),s=r(a(687)),o=a(781),n={"http:":i.default,"https:":s.default},l=new Set([301,302,303,307,308]),c=new Set([429,503]),u=["connect","continue","information","socket","timeout","upgrade"],d=["aborted"];function p(e,t={}){var a;const r=Object.assign({},p.defaultOptions,t),i=new o.PassThrough({highWaterMark:r.highWaterMark});let s,m,h;i.destroyed=i.aborted=!1;let b,f,g,y=0,T=0,E=0,_=!1,v=0,w=0;if(null===(a=r.headers)||void 0===a?void 0:a.Range){let e=/bytes=(\d+)-(\d+)?/.exec(`${r.headers.Range}`);e&&(v=parseInt(e[1],10),g=parseInt(e[2],10))}r.acceptEncoding&&(r.headers=Object.assign({"Accept-Encoding":Object.keys(r.acceptEncoding).join(", ")},r.headers));const I=e=>!!("HEAD"!==t.method&&_&&w!==f&&E++<r.maxReconnects)&&((e=>{h=null,T=0;let t=r.backoff.inc,a=Math.min(t,r.backoff.max);b=setTimeout(A,a),i.emit("reconnect",E,e)})(e),!0),R=e=>{if(i.destroyed)return!1;if(h&&w>0)return I(e.err);if((!e.err||"ENOTFOUND"===e.err.message)&&T++<r.maxRetries){let t=e.retryAfter||Math.min(T*r.backoff.inc,r.backoff.max);return b=setTimeout(A,t),i.emit("retry",T,e.err),!0}return!1},D=(e,t)=>{for(let a of t)e.on(a,i.emit.bind(i,a))},A=()=>{let t,a={};try{let r="string"==typeof e?new URL(e):e;a=Object.assign({},{host:r.host,hostname:r.hostname,path:r.pathname+r.search+r.hash,port:r.port,protocol:r.protocol}),r.username&&(a.auth=`${r.username}:${r.password}`),t=n[String(a.protocol)]}catch(e){}if(!t)return void i.emit("error",new p.MinigetError(`Invalid URL: ${e}`));if(Object.assign(a,r),_&&w>0){let e=w+v,t=g||"";a.headers=Object.assign({},a.headers,{Range:`bytes=${e}-${t}`})}if(r.transform){try{a=r.transform(a)}catch(e){return void i.emit("error",e)}if((!a||a.protocol)&&(t=n[String(null==a?void 0:a.protocol)],!t))return void i.emit("error",new p.MinigetError("Invalid URL object from `transform` function"))}const o=e=>{i.destroyed||i.readableEnded||i._readableState.ended||(T(),R({err:e})?s.removeListener("close",b):i.emit("error",e))},b=()=>{T(),R({})},T=()=>{s.removeListener("close",b),null==m||m.removeListener("data",E),null==h||h.removeListener("end",x)},E=e=>{w+=e.length},x=()=>{T(),I()||i.end()};s=t.request(a,(t=>{if(!i.destroyed)if(l.has(t.statusCode)){if(y++>=r.maxRedirects)i.emit("error",new p.MinigetError("Too many redirects"));else{if(!t.headers.location){let e=new p.MinigetError("Redirect status code given with no location",t.statusCode);return i.emit("error",e),void T()}e=t.headers.location,setTimeout(A,1e3*parseInt(t.headers["retry-after"]||"0",10)),i.emit("redirect",e)}T()}else if(c.has(t.statusCode)){if(!R({retryAfter:parseInt(t.headers["retry-after"]||"0",10)})){let e=new p.MinigetError(`Status code: ${t.statusCode}`,t.statusCode);i.emit("error",e)}T()}else{if(t.statusCode&&(t.statusCode<200||t.statusCode>=400)){let e=new p.MinigetError(`Status code: ${t.statusCode}`,t.statusCode);return t.statusCode>=500?o(e):i.emit("error",e),void T()}if(h=t,r.acceptEncoding&&t.headers["content-encoding"])for(let e of t.headers["content-encoding"].split(", ").reverse()){let t=r.acceptEncoding[e];t&&(h=h.pipe(t()),h.on("error",o))}f||(f=parseInt(`${t.headers["content-length"]}`,10),_="bytes"===t.headers["accept-ranges"]&&f>0&&r.maxReconnects>0),t.on("data",E),h.on("end",x),h.pipe(i,{end:!_}),m=t,i.emit("response",t),t.on("error",o),D(t,d)}})),s.on("error",o),s.on("close",b),D(s,u),i.destroyed&&L(...N),i.emit("request",s),s.end()};let N;i.abort=e=>{console.warn("`MinigetStream#abort()` has been deprecated in favor of `MinigetStream#destroy()`"),i.aborted=!0,i.emit("abort"),i.destroy(e)};const L=e=>{s.destroy(e),null==h||h.unpipe(i),null==h||h.destroy(),clearTimeout(b)};return i._destroy=(...e)=>{i.destroyed=!0,s?L(...e):N=e},i.text=()=>new Promise(((e,t)=>{let a="";i.setEncoding("utf8"),i.on("data",(e=>a+=e)),i.on("end",(()=>e(a))),i.on("error",t)})),process.nextTick(A),i}p.MinigetError=class extends Error{constructor(e,t){super(e),this.statusCode=t}},p.defaultOptions={maxRedirects:10,maxRetries:2,maxReconnects:0,backoff:{inc:100,max:1e4}},e.exports=p},99:(e,t,a)=>{!function(e){e.parser=function(e,t){return new i(e,t)},e.SAXParser=i,e.SAXStream=o,e.createStream=function(e,t){return new o(e,t)},e.MAX_BUFFER_LENGTH=65536;var t,r=["comment","sgmlDecl","textNode","tagName","doctype","procInstName","procInstBody","entity","attribName","attribValue","cdata","script"];function i(t,a){if(!(this instanceof i))return new i(t,a);var s=this;!function(e){for(var t=0,a=r.length;t<a;t++)e[r[t]]=""}(s),s.q=s.c="",s.bufferCheckPosition=e.MAX_BUFFER_LENGTH,s.opt=a||{},s.opt.lowercase=s.opt.lowercase||s.opt.lowercasetags,s.looseCase=s.opt.lowercase?"toLowerCase":"toUpperCase",s.tags=[],s.closed=s.closedRoot=s.sawRoot=!1,s.tag=s.error=null,s.strict=!!t,s.noscript=!(!t&&!s.opt.noscript),s.state=v.BEGIN,s.strictEntities=s.opt.strictEntities,s.ENTITIES=s.strictEntities?Object.create(e.XML_ENTITIES):Object.create(e.ENTITIES),s.attribList=[],s.opt.xmlns&&(s.ns=Object.create(c)),s.trackPosition=!1!==s.opt.position,s.trackPosition&&(s.position=s.line=s.column=0),I(s,"onready")}e.EVENTS=["text","processinginstruction","sgmldeclaration","doctype","comment","opentagstart","attribute","opentag","closetag","opencdata","cdata","closecdata","error","end","ready","script","opennamespace","closenamespace"],Object.create||(Object.create=function(e){function t(){}return t.prototype=e,new t}),Object.keys||(Object.keys=function(e){var t=[];for(var a in e)e.hasOwnProperty(a)&&t.push(a);return t}),i.prototype={end:function(){L(this)},write:function(t){var a=this;if(this.error)throw this.error;if(a.closed)return N(a,"Cannot write after close. Assign an onready handler.");if(null===t)return L(a);"object"==typeof t&&(t=t.toString());for(var i=0,s="";s=F(t,i++),a.c=s,s;)switch(a.trackPosition&&(a.position++,"\n"===s?(a.line++,a.column=0):a.column++),a.state){case v.BEGIN:if(a.state=v.BEGIN_WHITESPACE,"\ufeff"===s)continue;q(a,s);continue;case v.BEGIN_WHITESPACE:q(a,s);continue;case v.TEXT:if(a.sawRoot&&!a.closedRoot){for(var o=i-1;s&&"<"!==s&&"&"!==s;)(s=F(t,i++))&&a.trackPosition&&(a.position++,"\n"===s?(a.line++,a.column=0):a.column++);a.textNode+=t.substring(o,i-1)}"<"!==s||a.sawRoot&&a.closedRoot&&!a.strict?(h(s)||a.sawRoot&&!a.closedRoot||x(a,"Text data outside of root node."),"&"===s?a.state=v.TEXT_ENTITY:a.textNode+=s):(a.state=v.OPEN_WAKA,a.startTagPosition=a.position);continue;case v.SCRIPT:"<"===s?a.state=v.SCRIPT_ENDING:a.script+=s;continue;case v.SCRIPT_ENDING:"/"===s?a.state=v.CLOSE_TAG:(a.script+="<"+s,a.state=v.SCRIPT);continue;case v.OPEN_WAKA:if("!"===s)a.state=v.SGML_DECL,a.sgmlDecl="";else if(h(s));else if(g(u,s))a.state=v.OPEN_TAG,a.tagName=s;else if("/"===s)a.state=v.CLOSE_TAG,a.tagName="";else if("?"===s)a.state=v.PROC_INST,a.procInstName=a.procInstBody="";else{if(x(a,"Unencoded <"),a.startTagPosition+1<a.position){var n=a.position-a.startTagPosition;s=new Array(n).join(" ")+s}a.textNode+="<"+s,a.state=v.TEXT}continue;case v.SGML_DECL:"[CDATA["===(a.sgmlDecl+s).toUpperCase()?(R(a,"onopencdata"),a.state=v.CDATA,a.sgmlDecl="",a.cdata=""):a.sgmlDecl+s==="--"?(a.state=v.COMMENT,a.comment="",a.sgmlDecl=""):"DOCTYPE"===(a.sgmlDecl+s).toUpperCase()?(a.state=v.DOCTYPE,(a.doctype||a.sawRoot)&&x(a,"Inappropriately located doctype declaration"),a.doctype="",a.sgmlDecl=""):">"===s?(R(a,"onsgmldeclaration",a.sgmlDecl),a.sgmlDecl="",a.state=v.TEXT):b(s)?(a.state=v.SGML_DECL_QUOTED,a.sgmlDecl+=s):a.sgmlDecl+=s;continue;case v.SGML_DECL_QUOTED:s===a.q&&(a.state=v.SGML_DECL,a.q=""),a.sgmlDecl+=s;continue;case v.DOCTYPE:">"===s?(a.state=v.TEXT,R(a,"ondoctype",a.doctype),a.doctype=!0):(a.doctype+=s,"["===s?a.state=v.DOCTYPE_DTD:b(s)&&(a.state=v.DOCTYPE_QUOTED,a.q=s));continue;case v.DOCTYPE_QUOTED:a.doctype+=s,s===a.q&&(a.q="",a.state=v.DOCTYPE);continue;case v.DOCTYPE_DTD:a.doctype+=s,"]"===s?a.state=v.DOCTYPE:b(s)&&(a.state=v.DOCTYPE_DTD_QUOTED,a.q=s);continue;case v.DOCTYPE_DTD_QUOTED:a.doctype+=s,s===a.q&&(a.state=v.DOCTYPE_DTD,a.q="");continue;case v.COMMENT:"-"===s?a.state=v.COMMENT_ENDING:a.comment+=s;continue;case v.COMMENT_ENDING:"-"===s?(a.state=v.COMMENT_ENDED,a.comment=A(a.opt,a.comment),a.comment&&R(a,"oncomment",a.comment),a.comment=""):(a.comment+="-"+s,a.state=v.COMMENT);continue;case v.COMMENT_ENDED:">"!==s?(x(a,"Malformed comment"),a.comment+="--"+s,a.state=v.COMMENT):a.state=v.TEXT;continue;case v.CDATA:"]"===s?a.state=v.CDATA_ENDING:a.cdata+=s;continue;case v.CDATA_ENDING:"]"===s?a.state=v.CDATA_ENDING_2:(a.cdata+="]"+s,a.state=v.CDATA);continue;case v.CDATA_ENDING_2:">"===s?(a.cdata&&R(a,"oncdata",a.cdata),R(a,"onclosecdata"),a.cdata="",a.state=v.TEXT):"]"===s?a.cdata+="]":(a.cdata+="]]"+s,a.state=v.CDATA);continue;case v.PROC_INST:"?"===s?a.state=v.PROC_INST_ENDING:h(s)?a.state=v.PROC_INST_BODY:a.procInstName+=s;continue;case v.PROC_INST_BODY:if(!a.procInstBody&&h(s))continue;"?"===s?a.state=v.PROC_INST_ENDING:a.procInstBody+=s;continue;case v.PROC_INST_ENDING:">"===s?(R(a,"onprocessinginstruction",{name:a.procInstName,body:a.procInstBody}),a.procInstName=a.procInstBody="",a.state=v.TEXT):(a.procInstBody+="?"+s,a.state=v.PROC_INST_BODY);continue;case v.OPEN_TAG:g(d,s)?a.tagName+=s:(O(a),">"===s?B(a):"/"===s?a.state=v.OPEN_TAG_SLASH:(h(s)||x(a,"Invalid character in tag name"),a.state=v.ATTRIB));continue;case v.OPEN_TAG_SLASH:">"===s?(B(a,!0),P(a)):(x(a,"Forward-slash in opening tag not followed by >"),a.state=v.ATTRIB);continue;case v.ATTRIB:if(h(s))continue;">"===s?B(a):"/"===s?a.state=v.OPEN_TAG_SLASH:g(u,s)?(a.attribName=s,a.attribValue="",a.state=v.ATTRIB_NAME):x(a,"Invalid attribute name");continue;case v.ATTRIB_NAME:"="===s?a.state=v.ATTRIB_VALUE:">"===s?(x(a,"Attribute without value"),a.attribValue=a.attribName,C(a),B(a)):h(s)?a.state=v.ATTRIB_NAME_SAW_WHITE:g(d,s)?a.attribName+=s:x(a,"Invalid attribute name");continue;case v.ATTRIB_NAME_SAW_WHITE:if("="===s)a.state=v.ATTRIB_VALUE;else{if(h(s))continue;x(a,"Attribute without value"),a.tag.attributes[a.attribName]="",a.attribValue="",R(a,"onattribute",{name:a.attribName,value:""}),a.attribName="",">"===s?B(a):g(u,s)?(a.attribName=s,a.state=v.ATTRIB_NAME):(x(a,"Invalid attribute name"),a.state=v.ATTRIB)}continue;case v.ATTRIB_VALUE:if(h(s))continue;b(s)?(a.q=s,a.state=v.ATTRIB_VALUE_QUOTED):(x(a,"Unquoted attribute value"),a.state=v.ATTRIB_VALUE_UNQUOTED,a.attribValue=s);continue;case v.ATTRIB_VALUE_QUOTED:if(s!==a.q){"&"===s?a.state=v.ATTRIB_VALUE_ENTITY_Q:a.attribValue+=s;continue}C(a),a.q="",a.state=v.ATTRIB_VALUE_CLOSED;continue;case v.ATTRIB_VALUE_CLOSED:h(s)?a.state=v.ATTRIB:">"===s?B(a):"/"===s?a.state=v.OPEN_TAG_SLASH:g(u,s)?(x(a,"No whitespace between attributes"),a.attribName=s,a.attribValue="",a.state=v.ATTRIB_NAME):x(a,"Invalid attribute name");continue;case v.ATTRIB_VALUE_UNQUOTED:if(!f(s)){"&"===s?a.state=v.ATTRIB_VALUE_ENTITY_U:a.attribValue+=s;continue}C(a),">"===s?B(a):a.state=v.ATTRIB;continue;case v.CLOSE_TAG:if(a.tagName)">"===s?P(a):g(d,s)?a.tagName+=s:a.script?(a.script+="</"+a.tagName,a.tagName="",a.state=v.SCRIPT):(h(s)||x(a,"Invalid tagname in closing tag"),a.state=v.CLOSE_TAG_SAW_WHITE);else{if(h(s))continue;y(u,s)?a.script?(a.script+="</"+s,a.state=v.SCRIPT):x(a,"Invalid tagname in closing tag."):a.tagName=s}continue;case v.CLOSE_TAG_SAW_WHITE:if(h(s))continue;">"===s?P(a):x(a,"Invalid characters in closing tag");continue;case v.TEXT_ENTITY:case v.ATTRIB_VALUE_ENTITY_Q:case v.ATTRIB_VALUE_ENTITY_U:var l,c;switch(a.state){case v.TEXT_ENTITY:l=v.TEXT,c="textNode";break;case v.ATTRIB_VALUE_ENTITY_Q:l=v.ATTRIB_VALUE_QUOTED,c="attribValue";break;case v.ATTRIB_VALUE_ENTITY_U:l=v.ATTRIB_VALUE_UNQUOTED,c="attribValue"}";"===s?(a[c]+=M(a),a.entity="",a.state=l):g(a.entity.length?m:p,s)?a.entity+=s:(x(a,"Invalid character in entity name"),a[c]+="&"+a.entity+s,a.entity="",a.state=l);continue;default:throw new Error(a,"Unknown state: "+a.state)}return a.position>=a.bufferCheckPosition&&function(t){for(var a=Math.max(e.MAX_BUFFER_LENGTH,10),i=0,s=0,o=r.length;s<o;s++){var n=t[r[s]].length;if(n>a)switch(r[s]){case"textNode":D(t);break;case"cdata":R(t,"oncdata",t.cdata),t.cdata="";break;case"script":R(t,"onscript",t.script),t.script="";break;default:N(t,"Max buffer length exceeded: "+r[s])}i=Math.max(i,n)}var l=e.MAX_BUFFER_LENGTH-i;t.bufferCheckPosition=l+t.position}(a),a},resume:function(){return this.error=null,this},close:function(){return this.write(null)},flush:function(){var e;D(e=this),""!==e.cdata&&(R(e,"oncdata",e.cdata),e.cdata=""),""!==e.script&&(R(e,"onscript",e.script),e.script="")}};try{t=a(781).Stream}catch(e){t=function(){}}var s=e.EVENTS.filter((function(e){return"error"!==e&&"end"!==e}));function o(e,a){if(!(this instanceof o))return new o(e,a);t.apply(this),this._parser=new i(e,a),this.writable=!0,this.readable=!0;var r=this;this._parser.onend=function(){r.emit("end")},this._parser.onerror=function(e){r.emit("error",e),r._parser.error=null},this._decoder=null,s.forEach((function(e){Object.defineProperty(r,"on"+e,{get:function(){return r._parser["on"+e]},set:function(t){if(!t)return r.removeAllListeners(e),r._parser["on"+e]=t,t;r.on(e,t)},enumerable:!0,configurable:!1})}))}o.prototype=Object.create(t.prototype,{constructor:{value:o}}),o.prototype.write=function(e){if("function"==typeof Buffer&&"function"==typeof Buffer.isBuffer&&Buffer.isBuffer(e)){if(!this._decoder){var t=a(576).StringDecoder;this._decoder=new t("utf8")}e=this._decoder.write(e)}return this._parser.write(e.toString()),this.emit("data",e),!0},o.prototype.end=function(e){return e&&e.length&&this.write(e),this._parser.end(),!0},o.prototype.on=function(e,a){var r=this;return r._parser["on"+e]||-1===s.indexOf(e)||(r._parser["on"+e]=function(){var t=1===arguments.length?[arguments[0]]:Array.apply(null,arguments);t.splice(0,0,e),r.emit.apply(r,t)}),t.prototype.on.call(r,e,a)};var n="http://www.w3.org/XML/1998/namespace",l="http://www.w3.org/2000/xmlns/",c={xml:n,xmlns:l},u=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,d=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/,p=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,m=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/;function h(e){return" "===e||"\n"===e||"\r"===e||"\t"===e}function b(e){return'"'===e||"'"===e}function f(e){return">"===e||h(e)}function g(e,t){return e.test(t)}function y(e,t){return!g(e,t)}var T,E,_,v=0;for(var w in e.STATE={BEGIN:v++,BEGIN_WHITESPACE:v++,TEXT:v++,TEXT_ENTITY:v++,OPEN_WAKA:v++,SGML_DECL:v++,SGML_DECL_QUOTED:v++,DOCTYPE:v++,DOCTYPE_QUOTED:v++,DOCTYPE_DTD:v++,DOCTYPE_DTD_QUOTED:v++,COMMENT_STARTING:v++,COMMENT:v++,COMMENT_ENDING:v++,COMMENT_ENDED:v++,CDATA:v++,CDATA_ENDING:v++,CDATA_ENDING_2:v++,PROC_INST:v++,PROC_INST_BODY:v++,PROC_INST_ENDING:v++,OPEN_TAG:v++,OPEN_TAG_SLASH:v++,ATTRIB:v++,ATTRIB_NAME:v++,ATTRIB_NAME_SAW_WHITE:v++,ATTRIB_VALUE:v++,ATTRIB_VALUE_QUOTED:v++,ATTRIB_VALUE_CLOSED:v++,ATTRIB_VALUE_UNQUOTED:v++,ATTRIB_VALUE_ENTITY_Q:v++,ATTRIB_VALUE_ENTITY_U:v++,CLOSE_TAG:v++,CLOSE_TAG_SAW_WHITE:v++,SCRIPT:v++,SCRIPT_ENDING:v++},e.XML_ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'"},e.ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'",AElig:198,Aacute:193,Acirc:194,Agrave:192,Aring:197,Atilde:195,Auml:196,Ccedil:199,ETH:208,Eacute:201,Ecirc:202,Egrave:200,Euml:203,Iacute:205,Icirc:206,Igrave:204,Iuml:207,Ntilde:209,Oacute:211,Ocirc:212,Ograve:210,Oslash:216,Otilde:213,Ouml:214,THORN:222,Uacute:218,Ucirc:219,Ugrave:217,Uuml:220,Yacute:221,aacute:225,acirc:226,aelig:230,agrave:224,aring:229,atilde:227,auml:228,ccedil:231,eacute:233,ecirc:234,egrave:232,eth:240,euml:235,iacute:237,icirc:238,igrave:236,iuml:239,ntilde:241,oacute:243,ocirc:244,ograve:242,oslash:248,otilde:245,ouml:246,szlig:223,thorn:254,uacute:250,ucirc:251,ugrave:249,uuml:252,yacute:253,yuml:255,copy:169,reg:174,nbsp:160,iexcl:161,cent:162,pound:163,curren:164,yen:165,brvbar:166,sect:167,uml:168,ordf:170,laquo:171,not:172,shy:173,macr:175,deg:176,plusmn:177,sup1:185,sup2:178,sup3:179,acute:180,micro:181,para:182,middot:183,cedil:184,ordm:186,raquo:187,frac14:188,frac12:189,frac34:190,iquest:191,times:215,divide:247,OElig:338,oelig:339,Scaron:352,scaron:353,Yuml:376,fnof:402,circ:710,tilde:732,Alpha:913,Beta:914,Gamma:915,Delta:916,Epsilon:917,Zeta:918,Eta:919,Theta:920,Iota:921,Kappa:922,Lambda:923,Mu:924,Nu:925,Xi:926,Omicron:927,Pi:928,Rho:929,Sigma:931,Tau:932,Upsilon:933,Phi:934,Chi:935,Psi:936,Omega:937,alpha:945,beta:946,gamma:947,delta:948,epsilon:949,zeta:950,eta:951,theta:952,iota:953,kappa:954,lambda:955,mu:956,nu:957,xi:958,omicron:959,pi:960,rho:961,sigmaf:962,sigma:963,tau:964,upsilon:965,phi:966,chi:967,psi:968,omega:969,thetasym:977,upsih:978,piv:982,ensp:8194,emsp:8195,thinsp:8201,zwnj:8204,zwj:8205,lrm:8206,rlm:8207,ndash:8211,mdash:8212,lsquo:8216,rsquo:8217,sbquo:8218,ldquo:8220,rdquo:8221,bdquo:8222,dagger:8224,Dagger:8225,bull:8226,hellip:8230,permil:8240,prime:8242,Prime:8243,lsaquo:8249,rsaquo:8250,oline:8254,frasl:8260,euro:8364,image:8465,weierp:8472,real:8476,trade:8482,alefsym:8501,larr:8592,uarr:8593,rarr:8594,darr:8595,harr:8596,crarr:8629,lArr:8656,uArr:8657,rArr:8658,dArr:8659,hArr:8660,forall:8704,part:8706,exist:8707,empty:8709,nabla:8711,isin:8712,notin:8713,ni:8715,prod:8719,sum:8721,minus:8722,lowast:8727,radic:8730,prop:8733,infin:8734,ang:8736,and:8743,or:8744,cap:8745,cup:8746,int:8747,there4:8756,sim:8764,cong:8773,asymp:8776,ne:8800,equiv:8801,le:8804,ge:8805,sub:8834,sup:8835,nsub:8836,sube:8838,supe:8839,oplus:8853,otimes:8855,perp:8869,sdot:8901,lceil:8968,rceil:8969,lfloor:8970,rfloor:8971,lang:9001,rang:9002,loz:9674,spades:9824,clubs:9827,hearts:9829,diams:9830},Object.keys(e.ENTITIES).forEach((function(t){var a=e.ENTITIES[t],r="number"==typeof a?String.fromCharCode(a):a;e.ENTITIES[t]=r})),e.STATE)e.STATE[e.STATE[w]]=w;function I(e,t,a){e[t]&&e[t](a)}function R(e,t,a){e.textNode&&D(e),I(e,t,a)}function D(e){e.textNode=A(e.opt,e.textNode),e.textNode&&I(e,"ontext",e.textNode),e.textNode=""}function A(e,t){return e.trim&&(t=t.trim()),e.normalize&&(t=t.replace(/\s+/g," ")),t}function N(e,t){return D(e),e.trackPosition&&(t+="\nLine: "+e.line+"\nColumn: "+e.column+"\nChar: "+e.c),t=new Error(t),e.error=t,I(e,"onerror",t),e}function L(e){return e.sawRoot&&!e.closedRoot&&x(e,"Unclosed root tag"),e.state!==v.BEGIN&&e.state!==v.BEGIN_WHITESPACE&&e.state!==v.TEXT&&N(e,"Unexpected end"),D(e),e.c="",e.closed=!0,I(e,"onend"),i.call(e,e.strict,e.opt),e}function x(e,t){if("object"!=typeof e||!(e instanceof i))throw new Error("bad call to strictFail");e.strict&&N(e,t)}function O(e){e.strict||(e.tagName=e.tagName[e.looseCase]());var t=e.tags[e.tags.length-1]||e,a=e.tag={name:e.tagName,attributes:{}};e.opt.xmlns&&(a.ns=t.ns),e.attribList.length=0,R(e,"onopentagstart",a)}function S(e,t){var a=e.indexOf(":")<0?["",e]:e.split(":"),r=a[0],i=a[1];return t&&"xmlns"===e&&(r="xmlns",i=""),{prefix:r,local:i}}function C(e){if(e.strict||(e.attribName=e.attribName[e.looseCase]()),-1!==e.attribList.indexOf(e.attribName)||e.tag.attributes.hasOwnProperty(e.attribName))e.attribName=e.attribValue="";else{if(e.opt.xmlns){var t=S(e.attribName,!0),a=t.prefix,r=t.local;if("xmlns"===a)if("xml"===r&&e.attribValue!==n)x(e,"xml: prefix must be bound to "+n+"\nActual: "+e.attribValue);else if("xmlns"===r&&e.attribValue!==l)x(e,"xmlns: prefix must be bound to "+l+"\nActual: "+e.attribValue);else{var i=e.tag,s=e.tags[e.tags.length-1]||e;i.ns===s.ns&&(i.ns=Object.create(s.ns)),i.ns[r]=e.attribValue}e.attribList.push([e.attribName,e.attribValue])}else e.tag.attributes[e.attribName]=e.attribValue,R(e,"onattribute",{name:e.attribName,value:e.attribValue});e.attribName=e.attribValue=""}}function B(e,t){if(e.opt.xmlns){var a=e.tag,r=S(e.tagName);a.prefix=r.prefix,a.local=r.local,a.uri=a.ns[r.prefix]||"",a.prefix&&!a.uri&&(x(e,"Unbound namespace prefix: "+JSON.stringify(e.tagName)),a.uri=r.prefix);var i=e.tags[e.tags.length-1]||e;a.ns&&i.ns!==a.ns&&Object.keys(a.ns).forEach((function(t){R(e,"onopennamespace",{prefix:t,uri:a.ns[t]})}));for(var s=0,o=e.attribList.length;s<o;s++){var n=e.attribList[s],l=n[0],c=n[1],u=S(l,!0),d=u.prefix,p=u.local,m=""===d?"":a.ns[d]||"",h={name:l,value:c,prefix:d,local:p,uri:m};d&&"xmlns"!==d&&!m&&(x(e,"Unbound namespace prefix: "+JSON.stringify(d)),h.uri=d),e.tag.attributes[l]=h,R(e,"onattribute",h)}e.attribList.length=0}e.tag.isSelfClosing=!!t,e.sawRoot=!0,e.tags.push(e.tag),R(e,"onopentag",e.tag),t||(e.noscript||"script"!==e.tagName.toLowerCase()?e.state=v.TEXT:e.state=v.SCRIPT,e.tag=null,e.tagName=""),e.attribName=e.attribValue="",e.attribList.length=0}function P(e){if(!e.tagName)return x(e,"Weird empty close tag."),e.textNode+="</>",void(e.state=v.TEXT);if(e.script){if("script"!==e.tagName)return e.script+="</"+e.tagName+">",e.tagName="",void(e.state=v.SCRIPT);R(e,"onscript",e.script),e.script=""}var t=e.tags.length,a=e.tagName;e.strict||(a=a[e.looseCase]());for(var r=a;t--&&e.tags[t].name!==r;)x(e,"Unexpected close tag");if(t<0)return x(e,"Unmatched closing tag: "+e.tagName),e.textNode+="</"+e.tagName+">",void(e.state=v.TEXT);e.tagName=a;for(var i=e.tags.length;i-- >t;){var s=e.tag=e.tags.pop();e.tagName=e.tag.name,R(e,"onclosetag",e.tagName);var o={};for(var n in s.ns)o[n]=s.ns[n];var l=e.tags[e.tags.length-1]||e;e.opt.xmlns&&s.ns!==l.ns&&Object.keys(s.ns).forEach((function(t){var a=s.ns[t];R(e,"onclosenamespace",{prefix:t,uri:a})}))}0===t&&(e.closedRoot=!0),e.tagName=e.attribValue=e.attribName="",e.attribList.length=0,e.state=v.TEXT}function M(e){var t,a=e.entity,r=a.toLowerCase(),i="";return e.ENTITIES[a]?e.ENTITIES[a]:e.ENTITIES[r]?e.ENTITIES[r]:("#"===(a=r).charAt(0)&&("x"===a.charAt(1)?(a=a.slice(2),i=(t=parseInt(a,16)).toString(16)):(a=a.slice(1),i=(t=parseInt(a,10)).toString(10))),a=a.replace(/^0+/,""),isNaN(t)||i.toLowerCase()!==a?(x(e,"Invalid character entity"),"&"+e.entity+";"):String.fromCodePoint(t))}function q(e,t){"<"===t?(e.state=v.OPEN_WAKA,e.startTagPosition=e.position):h(t)||(x(e,"Non-whitespace before first tag."),e.textNode=t,e.state=v.TEXT)}function F(e,t){var a="";return t<e.length&&(a=e.charAt(t)),a}v=e.STATE,String.fromCodePoint||(T=String.fromCharCode,E=Math.floor,_=function(){var e,t,a=16384,r=[],i=-1,s=arguments.length;if(!s)return"";for(var o="";++i<s;){var n=Number(arguments[i]);if(!isFinite(n)||n<0||n>1114111||E(n)!==n)throw RangeError("Invalid code point: "+n);n<=65535?r.push(n):(e=55296+((n-=65536)>>10),t=n%1024+56320,r.push(e,t)),(i+1===s||r.length>a)&&(o+=T.apply(null,r),r.length=0)}return o},Object.defineProperty?Object.defineProperty(String,"fromCodePoint",{value:_,configurable:!0,writable:!0}):String.fromCodePoint=_)}(t)},954:(e,t,a)=>{const{setTimeout:r}=a(512);e.exports=class extends Map{constructor(e=1e3){super(),this.timeout=e}set(e,t){this.has(e)&&clearTimeout(super.get(e).tid),super.set(e,{tid:r(this.delete.bind(this,e),this.timeout).unref(),value:t})}get(e){let t=super.get(e);return t?t.value:null}getOrSet(e,t){if(this.has(e))return this.get(e);{let a=t();return this.set(e,a),(async()=>{try{await a}catch(t){this.delete(e)}})(),a}}delete(e){let t=super.get(e);t&&(clearTimeout(t.tid),super.delete(e))}clear(){for(let e of this.values())clearTimeout(e.tid);super.clear()}}},235:(e,t,a)=>{const r=a(901),i=a(414),s=["mp4a","mp3","vorbis","aac","opus","flac"],o=["mp4v","avc1","Sorenson H.283","MPEG-4 Visual","VP8","VP9","H.264"],n=e=>e.bitrate||0,l=e=>o.findIndex((t=>e.codecs&&e.codecs.includes(t))),c=e=>e.audioBitrate||0,u=e=>s.findIndex((t=>e.codecs&&e.codecs.includes(t))),d=(e,t,a)=>{let r=0;for(let i of a)if(r=i(t)-i(e),0!==r)break;return r},p=(e,t)=>d(e,t,[e=>parseInt(e.qualityLabel),n,l]),m=(e,t)=>d(e,t,[c,u]);t.sortFormats=(e,t)=>d(e,t,[e=>+!!e.isHLS,e=>+!!e.isDashMPD,e=>+(e.contentLength>0),e=>+(e.hasVideo&&e.hasAudio),e=>+e.hasVideo,e=>parseInt(e.qualityLabel)||0,n,c,l,u]),t.chooseFormat=(e,a)=>{if("object"==typeof a.format){if(!a.format.url)throw Error("Invalid format given, did you use `ytdl.getInfo()`?");return a.format}let r;a.filter&&(e=t.filterFormats(e,a.filter)),e.some((e=>e.isHLS))&&(e=e.filter((e=>e.isHLS||!e.isLive)));const i=a.quality||"highest";switch(i){case"highest":r=e[0];break;case"lowest":r=e[e.length-1];break;case"highestaudio":{(e=t.filterFormats(e,"audio")).sort(m);const a=e[0],i=(e=e.filter((e=>0===m(a,e)))).map((e=>parseInt(e.qualityLabel)||0)).sort(((e,t)=>e-t))[0];r=e.find((e=>(parseInt(e.qualityLabel)||0)===i));break}case"lowestaudio":(e=t.filterFormats(e,"audio")).sort(m),r=e[e.length-1];break;case"highestvideo":{(e=t.filterFormats(e,"video")).sort(p);const a=e[0],i=(e=e.filter((e=>0===p(a,e)))).map((e=>e.audioBitrate||0)).sort(((e,t)=>e-t))[0];r=e.find((e=>(e.audioBitrate||0)===i));break}case"lowestvideo":(e=t.filterFormats(e,"video")).sort(p),r=e[e.length-1];break;default:r=h(i,e)}if(!r)throw Error(`No such format found: ${i}`);return r};const h=(e,t)=>{let a=e=>t.find((t=>`${t.itag}`==`${e}`));return Array.isArray(e)?a(e.find((e=>a(e)))):a(e)};t.filterFormats=(e,t)=>{let a;switch(t){case"videoandaudio":case"audioandvideo":a=e=>e.hasVideo&&e.hasAudio;break;case"video":a=e=>e.hasVideo;break;case"videoonly":a=e=>e.hasVideo&&!e.hasAudio;break;case"audio":a=e=>e.hasAudio;break;case"audioonly":a=e=>!e.hasVideo&&e.hasAudio;break;default:if("function"!=typeof t)throw TypeError(`Given filter (${t}) is not supported`);a=t}return e.filter((e=>!!e.url&&a(e)))},t.addFormatMeta=e=>((e=Object.assign({},i[e.itag],e)).hasVideo=!!e.qualityLabel,e.hasAudio=!!e.audioBitrate,e.container=e.mimeType?e.mimeType.split(";")[0].split("/")[1]:null,e.codecs=e.mimeType?r.between(e.mimeType,'codecs="','"'):null,e.videoCodec=e.hasVideo&&e.codecs?e.codecs.split(", ")[0]:null,e.audioCodec=e.hasAudio&&e.codecs?e.codecs.split(", ").slice(-1)[0]:null,e.isLive=/\bsource[/=]yt_live_broadcast\b/.test(e.url),e.isHLS=/\/manifest\/hls_(variant|playlist)\//.test(e.url),e.isDashMPD=/\/manifest\/dash\//.test(e.url),e)},414:e=>{e.exports={5:{mimeType:'video/flv; codecs="Sorenson H.283, mp3"',qualityLabel:"240p",bitrate:25e4,audioBitrate:64},6:{mimeType:'video/flv; codecs="Sorenson H.263, mp3"',qualityLabel:"270p",bitrate:8e5,audioBitrate:64},13:{mimeType:'video/3gp; codecs="MPEG-4 Visual, aac"',qualityLabel:null,bitrate:5e5,audioBitrate:null},17:{mimeType:'video/3gp; codecs="MPEG-4 Visual, aac"',qualityLabel:"144p",bitrate:5e4,audioBitrate:24},18:{mimeType:'video/mp4; codecs="H.264, aac"',qualityLabel:"360p",bitrate:5e5,audioBitrate:96},22:{mimeType:'video/mp4; codecs="H.264, aac"',qualityLabel:"720p",bitrate:2e6,audioBitrate:192},34:{mimeType:'video/flv; codecs="H.264, aac"',qualityLabel:"360p",bitrate:5e5,audioBitrate:128},35:{mimeType:'video/flv; codecs="H.264, aac"',qualityLabel:"480p",bitrate:8e5,audioBitrate:128},36:{mimeType:'video/3gp; codecs="MPEG-4 Visual, aac"',qualityLabel:"240p",bitrate:175e3,audioBitrate:32},37:{mimeType:'video/mp4; codecs="H.264, aac"',qualityLabel:"1080p",bitrate:3e6,audioBitrate:192},38:{mimeType:'video/mp4; codecs="H.264, aac"',qualityLabel:"3072p",bitrate:35e5,audioBitrate:192},43:{mimeType:'video/webm; codecs="VP8, vorbis"',qualityLabel:"360p",bitrate:5e5,audioBitrate:128},44:{mimeType:'video/webm; codecs="VP8, vorbis"',qualityLabel:"480p",bitrate:1e6,audioBitrate:128},45:{mimeType:'video/webm; codecs="VP8, vorbis"',qualityLabel:"720p",bitrate:2e6,audioBitrate:192},46:{mimeType:'audio/webm; codecs="vp8, vorbis"',qualityLabel:"1080p",bitrate:null,audioBitrate:192},82:{mimeType:'video/mp4; codecs="H.264, aac"',qualityLabel:"360p",bitrate:5e5,audioBitrate:96},83:{mimeType:'video/mp4; codecs="H.264, aac"',qualityLabel:"240p",bitrate:5e5,audioBitrate:96},84:{mimeType:'video/mp4; codecs="H.264, aac"',qualityLabel:"720p",bitrate:2e6,audioBitrate:192},85:{mimeType:'video/mp4; codecs="H.264, aac"',qualityLabel:"1080p",bitrate:3e6,audioBitrate:192},91:{mimeType:'video/ts; codecs="H.264, aac"',qualityLabel:"144p",bitrate:1e5,audioBitrate:48},92:{mimeType:'video/ts; codecs="H.264, aac"',qualityLabel:"240p",bitrate:15e4,audioBitrate:48},93:{mimeType:'video/ts; codecs="H.264, aac"',qualityLabel:"360p",bitrate:5e5,audioBitrate:128},94:{mimeType:'video/ts; codecs="H.264, aac"',qualityLabel:"480p",bitrate:8e5,audioBitrate:128},95:{mimeType:'video/ts; codecs="H.264, aac"',qualityLabel:"720p",bitrate:15e5,audioBitrate:256},96:{mimeType:'video/ts; codecs="H.264, aac"',qualityLabel:"1080p",bitrate:25e5,audioBitrate:256},100:{mimeType:'audio/webm; codecs="VP8, vorbis"',qualityLabel:"360p",bitrate:null,audioBitrate:128},101:{mimeType:'audio/webm; codecs="VP8, vorbis"',qualityLabel:"360p",bitrate:null,audioBitrate:192},102:{mimeType:'audio/webm; codecs="VP8, vorbis"',qualityLabel:"720p",bitrate:null,audioBitrate:192},120:{mimeType:'video/flv; codecs="H.264, aac"',qualityLabel:"720p",bitrate:2e6,audioBitrate:128},127:{mimeType:'audio/ts; codecs="aac"',qualityLabel:null,bitrate:null,audioBitrate:96},128:{mimeType:'audio/ts; codecs="aac"',qualityLabel:null,bitrate:null,audioBitrate:96},132:{mimeType:'video/ts; codecs="H.264, aac"',qualityLabel:"240p",bitrate:15e4,audioBitrate:48},133:{mimeType:'video/mp4; codecs="H.264"',qualityLabel:"240p",bitrate:2e5,audioBitrate:null},134:{mimeType:'video/mp4; codecs="H.264"',qualityLabel:"360p",bitrate:3e5,audioBitrate:null},135:{mimeType:'video/mp4; codecs="H.264"',qualityLabel:"480p",bitrate:5e5,audioBitrate:null},136:{mimeType:'video/mp4; codecs="H.264"',qualityLabel:"720p",bitrate:1e6,audioBitrate:null},137:{mimeType:'video/mp4; codecs="H.264"',qualityLabel:"1080p",bitrate:25e5,audioBitrate:null},138:{mimeType:'video/mp4; codecs="H.264"',qualityLabel:"4320p",bitrate:135e5,audioBitrate:null},139:{mimeType:'audio/mp4; codecs="aac"',qualityLabel:null,bitrate:null,audioBitrate:48},140:{mimeType:'audio/m4a; codecs="aac"',qualityLabel:null,bitrate:null,audioBitrate:128},141:{mimeType:'audio/mp4; codecs="aac"',qualityLabel:null,bitrate:null,audioBitrate:256},151:{mimeType:'video/ts; codecs="H.264, aac"',qualityLabel:"720p",bitrate:5e4,audioBitrate:24},160:{mimeType:'video/mp4; codecs="H.264"',qualityLabel:"144p",bitrate:1e5,audioBitrate:null},171:{mimeType:'audio/webm; codecs="vorbis"',qualityLabel:null,bitrate:null,audioBitrate:128},172:{mimeType:'audio/webm; codecs="vorbis"',qualityLabel:null,bitrate:null,audioBitrate:192},242:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"240p",bitrate:1e5,audioBitrate:null},243:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"360p",bitrate:25e4,audioBitrate:null},244:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"480p",bitrate:5e5,audioBitrate:null},247:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"720p",bitrate:7e5,audioBitrate:null},248:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"1080p",bitrate:15e5,audioBitrate:null},249:{mimeType:'audio/webm; codecs="opus"',qualityLabel:null,bitrate:null,audioBitrate:48},250:{mimeType:'audio/webm; codecs="opus"',qualityLabel:null,bitrate:null,audioBitrate:64},251:{mimeType:'audio/webm; codecs="opus"',qualityLabel:null,bitrate:null,audioBitrate:160},264:{mimeType:'video/mp4; codecs="H.264"',qualityLabel:"1440p",bitrate:4e6,audioBitrate:null},266:{mimeType:'video/mp4; codecs="H.264"',qualityLabel:"2160p",bitrate:125e5,audioBitrate:null},271:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"1440p",bitrate:9e6,audioBitrate:null},272:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"4320p",bitrate:2e7,audioBitrate:null},278:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"144p 30fps",bitrate:8e4,audioBitrate:null},298:{mimeType:'video/mp4; codecs="H.264"',qualityLabel:"720p",bitrate:3e6,audioBitrate:null},299:{mimeType:'video/mp4; codecs="H.264"',qualityLabel:"1080p",bitrate:55e5,audioBitrate:null},300:{mimeType:'video/ts; codecs="H.264, aac"',qualityLabel:"720p",bitrate:1318e3,audioBitrate:48},302:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"720p HFR",bitrate:25e5,audioBitrate:null},303:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"1080p HFR",bitrate:5e6,audioBitrate:null},308:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"1440p HFR",bitrate:1e7,audioBitrate:null},313:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"2160p",bitrate:13e6,audioBitrate:null},315:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"2160p HFR",bitrate:2e7,audioBitrate:null},330:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"144p HDR, HFR",bitrate:8e4,audioBitrate:null},331:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"240p HDR, HFR",bitrate:1e5,audioBitrate:null},332:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"360p HDR, HFR",bitrate:25e4,audioBitrate:null},333:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"240p HDR, HFR",bitrate:5e5,audioBitrate:null},334:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"720p HDR, HFR",bitrate:1e6,audioBitrate:null},335:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"1080p HDR, HFR",bitrate:15e5,audioBitrate:null},336:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"1440p HDR, HFR",bitrate:5e6,audioBitrate:null},337:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"2160p HDR, HFR",bitrate:12e6,audioBitrate:null}}},270:(e,t,a)=>{const r=a(781).PassThrough,i=a(391),s=a(901),o=a(235),n=a(118),l=a(657),c=a(780),u=a(599),{parseTimestamp:d}=a(599),p=(e,t)=>{const a=m(t);return p.getInfo(e,t).then((e=>{b(a,e,t)}),a.emit.bind(a,"error")),a};e.exports=p,p.getBasicInfo=i.getBasicInfo,p.getInfo=i.getInfo,p.chooseFormat=o.chooseFormat,p.filterFormats=o.filterFormats,p.validateID=n.validateID,p.validateURL=n.validateURL,p.getURLVideoID=n.getURLVideoID,p.getVideoID=n.getVideoID,p.cache={sig:l.cache,info:i.cache,watch:i.watchPageCache,cookie:i.cookieCache},p.version=a(206).version;const m=e=>{const t=new r({highWaterMark:e&&e.highWaterMark||524288});return t._destroy=()=>{t.destroyed=!0},t},h=(e,t,a)=>{["abort","request","response","error","redirect","retry","reconnect"].forEach((a=>{e.prependListener(a,t.emit.bind(t,a))})),e.pipe(t,{end:a})},b=(e,t,a)=>{a=a||{};let r,i=s.playError(t.player_response,["UNPLAYABLE","LIVE_STREAM_OFFLINE","LOGIN_REQUIRED"]);if(i)return void e.emit("error",i);if(!t.formats.length)return void e.emit("error",Error("This video is unavailable"));try{r=o.chooseFormat(t.formats,a)}catch(t){return void e.emit("error",t)}if(e.emit("info",t,r),e.destroyed)return;let n,l=0;const p=t=>{l+=t.length,e.emit("progress",t.length,l,n)},m=a.dlChunkSize||10485760;let b,f=!0;if(r.isHLS||r.isDashMPD)b=u(r.url,{chunkReadahead:+t.live_chunk_readahead,begin:a.begin||r.isLive&&Date.now(),liveBuffer:a.liveBuffer,requestOptions:a.requestOptions,parser:r.isDashMPD?"dash-mpd":"m3u8",id:r.itag}),b.on("progress",((t,a)=>{e.emit("progress",t.size,t.num,a)})),h(b,e,f);else{const t=Object.assign({},a.requestOptions,{maxReconnects:6,maxRetries:3,backoff:{inc:500,max:1e4}});if(0===m||r.hasAudio&&r.hasVideo)a.begin&&(r.url+=`&begin=${d(a.begin)}`),a.range&&(a.range.start||a.range.end)&&(t.headers=Object.assign({},t.headers,{Range:`bytes=${a.range.start||"0"}-${a.range.end||""}`})),b=c(r.url,t),b.on("response",(t=>{e.destroyed||(n=n||parseInt(t.headers["content-length"]))})),b.on("data",p),h(b,e,f);else{let i=a.range&&a.range.start||0,s=i+m;const o=a.range&&a.range.end;n=a.range?(o?o+1:parseInt(r.contentLength))-i:parseInt(r.contentLength);const l=()=>{!o&&s>=n&&(s=0),o&&s>o&&(s=o),f=!s||s===o,t.headers=Object.assign({},t.headers,{Range:`bytes=${i}-${s||""}`}),b=c(r.url,t),b.on("data",p),b.on("end",(()=>{e.destroyed||s&&s!==o&&(i=s+1,s+=m,l())})),h(b,e,f)};l()}}e._destroy=()=>{e.destroyed=!0,b.destroy(),b.end()}};p.downloadFromInfo=(e,t)=>{const a=m(t);if(!e.full)throw Error("Cannot use `ytdl.downloadFromInfo()` when called with info from `ytdl.getBasicInfo()`");return setImmediate((()=>{b(a,e,t)})),a}},849:(e,t,a)=>{const r=a(901),i=a(477),{parseTimestamp:s}=a(599),o="https://www.youtube.com/watch?v=",n={song:{name:"Music",url:"https://music.youtube.com/"}},l=e=>e?e.runs?e.runs[0].text:e.simpleText:null;t.getMedia=e=>{let t={},a=[];try{a=e.response.contents.twoColumnWatchNextResults.results.results.contents}catch(e){}let r=a.find((e=>e.videoSecondaryInfoRenderer));if(!r)return{};try{let e=(r.metadataRowContainer||r.videoSecondaryInfoRenderer.metadataRowContainer).metadataRowContainerRenderer.rows;for(let a of e)if(a.metadataRowRenderer){let e=l(a.metadataRowRenderer.title).toLowerCase(),r=a.metadataRowRenderer.contents[0];t[e]=l(r);let i=r.runs;i&&i[0].navigationEndpoint&&(t[`${e}_url`]=new URL(i[0].navigationEndpoint.commandMetadata.webCommandMetadata.url,o).toString()),e in n&&(t.category=n[e].name,t.category_url=n[e].url)}else if(a.richMetadataRowRenderer){let e=a.richMetadataRowRenderer.contents,r=e.filter((e=>"RICH_METADATA_RENDERER_STYLE_BOX_ART"===e.richMetadataRenderer.style));for(let{richMetadataRenderer:e}of r){let a=e;t.year=l(a.subtitle);let r=l(a.callToAction).split(" ")[1];t[r]=l(a.title),t[`${r}_url`]=new URL(a.endpoint.commandMetadata.webCommandMetadata.url,o).toString(),t.thumbnails=a.thumbnail.thumbnails}let i=e.filter((e=>"RICH_METADATA_RENDERER_STYLE_TOPIC"===e.richMetadataRenderer.style));for(let{richMetadataRenderer:e}of i){let a=e;t.category=l(a.title),t.category_url=new URL(a.endpoint.commandMetadata.webCommandMetadata.url,o).toString()}}}catch(e){}return t};const c=e=>!(!e||!e.find((e=>"Verified"===e.metadataBadgeRenderer.tooltip)));t.getAuthor=e=>{let t,a,i=[],s=!1;try{let n=e.response.contents.twoColumnWatchNextResults.results.results.contents.find((e=>e.videoSecondaryInfoRenderer&&e.videoSecondaryInfoRenderer.owner&&e.videoSecondaryInfoRenderer.owner.videoOwnerRenderer)).videoSecondaryInfoRenderer.owner.videoOwnerRenderer;t=n.navigationEndpoint.browseEndpoint.browseId,i=n.thumbnail.thumbnails.map((e=>(e.url=new URL(e.url,o).toString(),e))),a=r.parseAbbreviatedNumber(l(n.subscriberCountText)),s=c(n.badges)}catch(e){}try{let n=e.player_response.microformat&&e.player_response.microformat.playerMicroformatRenderer,l=n&&n.channelId||t||e.player_response.videoDetails.channelId,c={id:l,name:n?n.ownerChannelName:e.player_response.videoDetails.author,user:n?n.ownerProfileUrl.split("/").slice(-1)[0]:null,channel_url:`https://www.youtube.com/channel/${l}`,external_channel_url:n?`https://www.youtube.com/channel/${n.externalChannelId}`:"",user_url:n?new URL(n.ownerProfileUrl,o).toString():"",thumbnails:i,verified:s,subscriber_count:a};return i.length&&r.deprecate(c,"avatar",c.thumbnails[0].url,"author.avatar","author.thumbnails[0].url"),c}catch(e){return{}}};const u=(e,t)=>{if(e)try{let a=l(e.viewCountText),i=l(e.shortViewCountText),n=t.find((t=>t.id===e.videoId));/^\d/.test(i)||(i=n&&n.short_view_count_text||""),a=(/^\d/.test(a)?a:i).split(" ")[0];let u=e.shortBylineText.runs[0].navigationEndpoint.browseEndpoint,d=u.browseId,p=l(e.shortBylineText),m=(u.canonicalBaseUrl||"").split("/").slice(-1)[0],h={id:e.videoId,title:l(e.title),published:l(e.publishedTimeText),author:{id:d,name:p,user:m,channel_url:`https://www.youtube.com/channel/${d}`,user_url:`https://www.youtube.com/user/${m}`,thumbnails:e.channelThumbnail.thumbnails.map((e=>(e.url=new URL(e.url,o).toString(),e))),verified:c(e.ownerBadges),[Symbol.toPrimitive]:()=>(console.warn("`relatedVideo.author` will be removed in a near future release, use `relatedVideo.author.name` instead."),h.author.name)},short_view_count_text:i.split(" ")[0],view_count:a.replace(/,/g,""),length_seconds:e.lengthText?Math.floor(s(l(e.lengthText))/1e3):t&&`${t.length_seconds}`,thumbnails:e.thumbnail.thumbnails,richThumbnails:e.richThumbnail?e.richThumbnail.movingThumbnailRenderer.movingThumbnailDetails.thumbnails:[],isLive:!(!e.badges||!e.badges.find((e=>"LIVE NOW"===e.metadataBadgeRenderer.label)))};return r.deprecate(h,"author_thumbnail",h.author.thumbnails[0].url,"relatedVideo.author_thumbnail","relatedVideo.author.thumbnails[0].url"),r.deprecate(h,"ucid",h.author.id,"relatedVideo.ucid","relatedVideo.author.id"),r.deprecate(h,"video_thumbnail",h.thumbnails[0].url,"relatedVideo.video_thumbnail","relatedVideo.thumbnails[0].url"),h}catch(e){}};t.getRelatedVideos=e=>{let t=[],a=[];try{t=e.response.webWatchNextResponseExtensionData.relatedVideoArgs.split(",").map((e=>i.parse(e)))}catch(e){}try{a=e.response.contents.twoColumnWatchNextResults.secondaryResults.secondaryResults.results}catch(e){return[]}let r=[];for(let e of a||[]){let a=e.compactVideoRenderer;if(a){let e=u(a,t);e&&r.push(e)}else{let a=e.compactAutoplayRenderer||e.itemSectionRenderer;if(!a||!Array.isArray(a.contents))continue;for(let e of a.contents){let a=u(e.compactVideoRenderer,t);a&&r.push(a)}}}return r},t.getLikes=e=>{try{let t=e.response.contents.twoColumnWatchNextResults.results.results.contents.find((e=>e.videoPrimaryInfoRenderer)).videoPrimaryInfoRenderer.videoActions.menuRenderer.topLevelButtons.find((e=>e.toggleButtonRenderer&&"LIKE"===e.toggleButtonRenderer.defaultIcon.iconType));return parseInt(t.toggleButtonRenderer.defaultText.accessibility.accessibilityData.label.replace(/\D+/g,""))}catch(e){return null}},t.getDislikes=e=>{try{let t=e.response.contents.twoColumnWatchNextResults.results.results.contents.find((e=>e.videoPrimaryInfoRenderer)).videoPrimaryInfoRenderer.videoActions.menuRenderer.topLevelButtons.find((e=>e.toggleButtonRenderer&&"DISLIKE"===e.toggleButtonRenderer.defaultIcon.iconType));return parseInt(t.toggleButtonRenderer.defaultText.accessibility.accessibilityData.label.replace(/\D+/g,""))}catch(e){return null}},t.cleanVideoDetails=(e,t)=>(e.thumbnails=e.thumbnail.thumbnails,delete e.thumbnail,r.deprecate(e,"thumbnail",{thumbnails:e.thumbnails},"videoDetails.thumbnail.thumbnails","videoDetails.thumbnails"),e.description=e.shortDescription||l(e.description),delete e.shortDescription,r.deprecate(e,"shortDescription",e.description,"videoDetails.shortDescription","videoDetails.description"),e.lengthSeconds=t.player_response.microformat&&t.player_response.microformat.playerMicroformatRenderer.lengthSeconds||t.player_response.videoDetails.lengthSeconds,e),t.getStoryboards=e=>{const t=e.player_response.storyboards&&e.player_response.storyboards.playerStoryboardSpecRenderer&&e.player_response.storyboards.playerStoryboardSpecRenderer.spec&&e.player_response.storyboards.playerStoryboardSpecRenderer.spec.split("|");if(!t)return[];const a=new URL(t.shift());return t.map(((e,t)=>{let[r,i,s,o,n,l,c,u]=e.split("#");a.searchParams.set("sigh",u),s=parseInt(s,10),o=parseInt(o,10),n=parseInt(n,10);const d=Math.ceil(s/(o*n));return{templateUrl:a.toString().replace("$L",t).replace("$N",c),thumbnailWidth:parseInt(r,10),thumbnailHeight:parseInt(i,10),thumbnailCount:s,interval:parseInt(l,10),columns:o,rows:n,storyboardCount:d}}))},t.getChapters=e=>{const t=e.response&&e.response.playerOverlays&&e.response.playerOverlays.playerOverlayRenderer,a=t&&t.decoratedPlayerBarRenderer&&t.decoratedPlayerBarRenderer.decoratedPlayerBarRenderer&&t.decoratedPlayerBarRenderer.decoratedPlayerBarRenderer.playerBar,r=a&&a.multiMarkersPlayerBarRenderer&&a.multiMarkersPlayerBarRenderer.markersMap,i=Array.isArray(r)&&r.find((e=>e.value&&Array.isArray(e.value.chapters)));return i?i.value.chapters.map((e=>({title:l(e.chapterRenderer.title),start_time:e.chapterRenderer.timeRangeStartMillis/1e3}))):[]}},391:(e,t,a)=>{const r=a(477),i=a(99),s=a(780),o=a(901),{setTimeout:n}=a(512),l=a(235),c=a(118),u=a(849),d=a(657),p=a(954),m="https://www.youtube.com/watch?v=";t.cache=new p,t.cookieCache=new p(864e5),t.watchPageCache=new p;let h="2.20210622.10.00";class b extends Error{}const f=["support.google.com/youtube/?p=age_restrictions","youtube.com/t/community_guidelines"];t.getBasicInfo=async(e,t)=>{const a=Object.assign({},s.defaultOptions,t.requestOptions);t.requestOptions=Object.assign({},t.requestOptions,{}),t.requestOptions.headers=Object.assign({},{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.101 Safari/537.36"},t.requestOptions.headers);let r=await w([e,t],(e=>{let t=o.playError(e.player_response,["ERROR"],b),a=g(e.player_response);if(t||a)throw t||a;return e&&e.player_response&&(e.player_response.streamingData||y(e.player_response)||T(e.player_response))}),a,[O,x,S]);Object.assign(r,{formats:C(r.player_response),related_videos:u.getRelatedVideos(r)});const i=u.getMedia(r),n={author:u.getAuthor(r),media:i,likes:u.getLikes(r),dislikes:u.getDislikes(r),age_restricted:!!(i&&i.notice_url&&f.some((e=>i.notice_url.includes(e)))),video_url:m+e,storyboards:u.getStoryboards(r),chapters:u.getChapters(r)};return r.videoDetails=u.cleanVideoDetails(Object.assign({},r.player_response&&r.player_response.microformat&&r.player_response.microformat.playerMicroformatRenderer,r.player_response&&r.player_response.videoDetails,n),r),r};const g=e=>{let t=e&&e.playabilityStatus;return t&&"LOGIN_REQUIRED"===t.status&&t.messages&&t.messages.filter((e=>/This is a private video/.test(e))).length?new b(t.reason||t.messages&&t.messages[0]):null},y=e=>{let t=e.playabilityStatus;return t&&"UNPLAYABLE"===t.status&&t.errorScreen&&t.errorScreen.playerLegacyDesktopYpcOfferRenderer},T=e=>{let t=e.playabilityStatus;return t&&"LIVE_STREAM_OFFLINE"===t.status},E=(e,t)=>`${m+e}&hl=${t.lang||"en"}`,_=(e,a)=>{const r=E(e,a);return t.watchPageCache.getOrSet(r,(()=>o.exposedMiniget(r,a).text()))},v=e=>{let t=/<script\s+src="([^"]+)"(?:\s+type="text\/javascript")?\s+name="player_ias\/base"\s*>|"jsUrl":"([^"]+)"/.exec(e);return t?t[1]||t[2]:null},w=async(e,t,a,r)=>{let i;for(let s of r)try{const r=await R(s,e.concat([i]),a);if(r.player_response&&(r.player_response.videoDetails=I(i&&i.player_response&&i.player_response.videoDetails,r.player_response.videoDetails),r.player_response=I(i&&i.player_response,r.player_response)),i=I(i,r),t(i,!1))break}catch(e){if(e instanceof b||s===r[r.length-1])throw e}return i},I=(e,t)=>{if(!e||!t)return e||t;for(let[a,r]of Object.entries(t))null!=r&&(e[a]=r);return e},R=async(e,t,a)=>{let r,i=0;for(;i<=a.maxRetries;)try{r=await e(...t);break}catch(e){if(e instanceof b||e instanceof s.MinigetError&&e.statusCode<500||i>=a.maxRetries)throw e;let t=Math.min(++i*a.backoff.inc,a.backoff.max);await new Promise((e=>n(e,t)))}return r},D=/^[)\]}'\s]+/,A=(e,t,a)=>{if(!a||"object"==typeof a)return a;try{return a=a.replace(D,""),JSON.parse(a)}catch(a){throw Error(`Error parsing ${t} in ${e}: ${a.message}`)}},N=(e,t,a,r,i,s)=>{let n=o.between(a,r,i);if(!n)throw Error(`Could not find ${t} in ${e}`);return A(e,t,o.cutAfterJSON(`${s}${n}`))},L=(e,t)=>{const a=t&&(t.args&&t.args.player_response||t.player_response||t.playerResponse||t.embedded_player_response);return A(e,"player_response",a)},x=async(e,a)=>{const r=Object.assign({headers:{}},a.requestOptions);let i=r.headers.Cookie||r.headers.cookie;r.headers=Object.assign({"x-youtube-client-name":"1","x-youtube-client-version":h,"x-youtube-identity-token":t.cookieCache.get(i||"browser")||""},r.headers);const s=async(i,s)=>{r.headers["x-youtube-identity-token"]||(r.headers["x-youtube-identity-token"]=await((e,a,r,i)=>t.cookieCache.getOrSet(r,(async()=>{let t=(await _(e,a)).match(/(["'])ID_TOKEN\1[:,]\s?"([^"]+)"/);if(!t&&i)throw new b("Cookie header used in request, but unable to find YouTube identity token");return t&&t[2]})))(e,a,i,s))};i&&await s(i,!0);const n=((e,t)=>`${E(e,t)}&pbj=1`)(e,a),l=await o.exposedMiniget(n,a,r).text();let c=A("watch.json","body",l);if("now"===c.reload&&await s("browser",!1),"now"===c.reload||!Array.isArray(c))throw Error("Unable to retrieve video metadata in watch.json");let u=c.reduce(((e,t)=>Object.assign(t,e)),{});return u.player_response=L("watch.json",u),u.html5player=u.player&&u.player.assets&&u.player.assets.js,u},O=async(e,t)=>{let a=await _(e,t),r={page:"watch"};try{h=o.between(a,'{"key":"cver","value":"','"}'),r.player_response=N("watch.html","player_response",a,/\bytInitialPlayerResponse\s*=\s*\{/i,"<\/script>","{")}catch(e){let t=N("watch.html","player_response",a,/\bytplayer\.config\s*=\s*{/,"<\/script>","{");r.player_response=L("watch.html",t)}return r.response=N("watch.html","response",a,/\bytInitialData("\])?\s*=\s*\{/i,"<\/script>","{"),r.html5player=v(a),r},S=async(e,t)=>{const a=new URL("https://www.youtube.com/get_video_info");a.searchParams.set("video_id",e),a.searchParams.set("c","TVHTML5"),a.searchParams.set("cver",`7${h.substr(1)}`),a.searchParams.set("eurl","https://youtube.googleapis.com/v/"+e),a.searchParams.set("ps","default"),a.searchParams.set("gl","US"),a.searchParams.set("hl",t.lang||"en"),a.searchParams.set("html5","1");const i=await o.exposedMiniget(a.toString(),t).text();let s=r.parse(i);return s.player_response=L("get_video_info",s),s},C=e=>{let t=[];return e&&e.streamingData&&(t=t.concat(e.streamingData.formats||[]).concat(e.streamingData.adaptiveFormats||[])),t};t.getInfo=async(e,a)=>{let r=await t.getBasicInfo(e,a);const i=r.player_response&&r.player_response.streamingData&&(r.player_response.streamingData.dashManifestUrl||r.player_response.streamingData.hlsManifestUrl);let s=[];if(r.formats.length){if(r.html5player=r.html5player||v(await _(e,a))||v(await((e,t)=>{const a=`${"https://www.youtube.com/embed/"+e}?hl=${t.lang||"en"}`;return o.exposedMiniget(a,t).text()})(e,a)),!r.html5player)throw Error("Unable to find html5player file");const t=new URL(r.html5player,m).toString();s.push(d.decipherFormats(r.formats,t,a))}if(i&&r.player_response.streamingData.dashManifestUrl){let e=r.player_response.streamingData.dashManifestUrl;s.push(B(e,a))}if(i&&r.player_response.streamingData.hlsManifestUrl){let e=r.player_response.streamingData.hlsManifestUrl;s.push(P(e,a))}let n=await Promise.all(s);return r.formats=Object.values(Object.assign({},...n)),r.formats=r.formats.map(l.addFormatMeta),r.formats.sort(l.sortFormats),r.full=!0,r};const B=(e,t)=>new Promise(((a,r)=>{let s={};const n=i.parser(!1);let l;n.onerror=r,n.onopentag=t=>{if("ADAPTATIONSET"===t.name)l=t.attributes;else if("REPRESENTATION"===t.name){const a=parseInt(t.attributes.ID);isNaN(a)||(s[e]=Object.assign({itag:a,url:e,bitrate:parseInt(t.attributes.BANDWIDTH),mimeType:`${l.MIMETYPE}; codecs="${t.attributes.CODECS}"`},t.attributes.HEIGHT?{width:parseInt(t.attributes.WIDTH),height:parseInt(t.attributes.HEIGHT),fps:parseInt(t.attributes.FRAMERATE)}:{audioSampleRate:t.attributes.AUDIOSAMPLINGRATE}))}},n.onend=()=>{a(s)};const c=o.exposedMiniget(new URL(e,m).toString(),t);c.setEncoding("utf8"),c.on("error",r),c.on("data",(e=>{n.write(e)})),c.on("end",n.close.bind(n))})),P=async(e,t)=>{e=new URL(e,m);const a=await o.exposedMiniget(e.toString(),t).text();let r={};return a.split("\n").filter((e=>/^https?:\/\//.test(e))).forEach((e=>{const t=parseInt(e.match(/\/itag\/(\d+)\//)[1]);r[e]={itag:t,url:e}})),r};for(let e of["getBasicInfo","getInfo"]){const a=t[e];t[e]=async(r,i={})=>{o.checkForUpdates();let s=await c.getVideoID(r);const n=[e,s,i.lang].join("-");return t.cache.getOrSet(n,(()=>a(s,i)))}}t.validateID=c.validateID,t.validateURL=c.validateURL,t.getURLVideoID=c.getURLVideoID,t.getVideoID=c.getVideoID},657:(e,t,a)=>{const r=a(477),i=a(954),s=a(901);t.cache=new i,t.getTokens=(e,a)=>t.cache.getOrSet(e,(async()=>{const r=await s.exposedMiniget(e,a).text(),i=t.extractActions(r);if(!i||!i.length)throw Error("Could not extract signature deciphering actions");return t.cache.set(e,i),i})),t.decipher=(e,t)=>{t=t.split("");for(let a=0,r=e.length;a<r;a++){let r,i=e[a];switch(i[0]){case"r":t=t.reverse();break;case"w":r=~~i.slice(1),t=o(t,r);break;case"s":r=~~i.slice(1),t=t.slice(r);break;case"p":r=~~i.slice(1),t.splice(0,r)}}return t.join("")};const o=(e,t)=>{const a=e[0];return e[0]=e[t%e.length],e[t]=a,e},n="[a-zA-Z_\\$][a-zA-Z_0-9]*",l="(?:'[^'\\\\]*(:?\\\\[\\s\\S][^'\\\\]*)*'|\"[^\"\\\\]*(:?\\\\[\\s\\S][^\"\\\\]*)*\")",c=`(?:${n}|${l})`,u=`(?:\\.${n}|\\[${l}\\])`,d=":function\\(a\\)\\{(?:return )?a\\.reverse\\(\\)\\}",p=":function\\(a,b\\)\\{return a\\.slice\\(b\\)\\}",m=":function\\(a,b\\)\\{a\\.splice\\(0,b\\)\\}",h=":function\\(a,b\\)\\{var c=a\\[0\\];a\\[0\\]=a\\[b(?:%a\\.length)?\\];a\\[b(?:%a\\.length)?\\]=c(?:;return a)?\\}",b=new RegExp(`var (${n})=\\{((?:(?:${c}${d}|${c}${p}|${c}${m}|${c}${h}),?\\r?\\n?)+)\\};`),f=new RegExp(`function(?: ${n})?\\(a\\)\\{a=a\\.split\\((?:''|"")\\);\\s*((?:(?:a=)?${n}${u}\\(a,\\d+\\);)+)return a\\.join\\((?:''|"")\\)\\}`),g=new RegExp(`(?:^|,)(${c})${d}`,"m"),y=new RegExp(`(?:^|,)(${c})${p}`,"m"),T=new RegExp(`(?:^|,)(${c})${m}`,"m"),E=new RegExp(`(?:^|,)(${c})${h}`,"m");t.extractActions=e=>{const t=b.exec(e),a=f.exec(e);if(!t||!a)return null;const r=t[1].replace(/\$/g,"\\$"),i=t[2].replace(/\$/g,"\\$"),s=a[1].replace(/\$/g,"\\$");let o=g.exec(i);const n=o&&o[1].replace(/\$/g,"\\$").replace(/\$|^'|^"|'$|"$/g,"");o=y.exec(i);const l=o&&o[1].replace(/\$/g,"\\$").replace(/\$|^'|^"|'$|"$/g,"");o=T.exec(i);const c=o&&o[1].replace(/\$/g,"\\$").replace(/\$|^'|^"|'$|"$/g,"");o=E.exec(i);const u=o&&o[1].replace(/\$/g,"\\$").replace(/\$|^'|^"|'$|"$/g,""),d=`(${[n,l,c,u].join("|")})`,p=new RegExp(`(?:a=)?${r}(?:\\.${d}|\\['${d}'\\]|\\["${d}"\\])\\(a,(\\d+)\\)`,"g"),m=[];for(;null!==(o=p.exec(s));)switch(o[1]||o[2]||o[3]){case u:m.push(`w${o[4]}`);break;case n:m.push("r");break;case l:m.push(`s${o[4]}`);break;case c:m.push(`p${o[4]}`)}return m},t.setDownloadURL=(e,t)=>{let a;if(!e.url)return;a=e.url;try{a=decodeURIComponent(a)}catch(e){return}const r=new URL(a);r.searchParams.set("ratebypass","yes"),t&&r.searchParams.set(e.sp||"signature",t),e.url=r.toString()},t.decipherFormats=async(e,a,i)=>{let s={},o=await t.getTokens(a,i);return e.forEach((e=>{let a=e.signatureCipher||e.cipher;a&&(Object.assign(e,r.parse(a)),delete e.signatureCipher,delete e.cipher);const i=o&&e.s?t.decipher(o,e.s):null;t.setDownloadURL(e,i),s[e.url]=e})),s}},118:(e,t)=>{const a=new Set(["youtube.com","www.youtube.com","m.youtube.com","music.youtube.com","gaming.youtube.com"]),r=/^https?:\/\/(youtu\.be\/|(www\.)?youtube\.com\/(embed|v|shorts)\/)/;t.getURLVideoID=e=>{const i=new URL(e);let o=i.searchParams.get("v");if(r.test(e)&&!o){const e=i.pathname.split("/");o="youtu.be"===i.host?e[1]:e[2]}else if(i.hostname&&!a.has(i.hostname))throw Error("Not a YouTube domain");if(!o)throw Error(`No video id found: ${e}`);if(o=o.substring(0,11),!t.validateID(o))throw TypeError(`Video id (${o}) does not match expected format (${s.toString()})`);return o};const i=/^https?:\/\//;t.getVideoID=e=>{if(t.validateID(e))return e;if(i.test(e))return t.getURLVideoID(e);throw Error(`No video id found: ${e}`)};const s=/^[a-zA-Z0-9-_]{11}$/;t.validateID=e=>s.test(e),t.validateURL=e=>{try{return t.getURLVideoID(e),!0}catch(e){return!1}}},901:(e,t,a)=>{const r=a(780);t.between=(e,t,a)=>{let r;if(t instanceof RegExp){const a=e.match(t);if(!a)return"";r=a.index+a[0].length}else{if(r=e.indexOf(t),-1===r)return"";r+=t.length}return r=(e=e.slice(r)).indexOf(a),-1===r?"":e=e.slice(0,r)},t.parseAbbreviatedNumber=e=>{const t=e.replace(",",".").replace(" ","").match(/([\d,.]+)([MK]?)/);if(t){let[,e,a]=t;return e=parseFloat(e),Math.round("M"===a?1e6*e:"K"===a?1e3*e:e)}return null},t.cutAfterJSON=e=>{let t,a;if("["===e[0]?(t="[",a="]"):"{"===e[0]&&(t="{",a="}"),!t)throw new Error(`Can't cut unsupported JSON (need to begin with [ or { ) but got: ${e[0]}`);let r,i=!1,s=!1,o=0;for(r=0;r<e.length;r++)if('"'!==e[r]||s){if(s="\\"===e[r]&&!s,!i&&(e[r]===t?o++:e[r]===a&&o--,0===o))return e.substr(0,r+1)}else i=!i;throw Error("Can't cut unsupported JSON (no matching closing bracket found)")},t.playError=(e,t,a=Error)=>{let r=e&&e.playabilityStatus;return r&&t.includes(r.status)?new a(r.reason||r.messages&&r.messages[0]):null},t.exposedMiniget=(e,t={},a)=>{const i=r(e,a||t.requestOptions);return"function"==typeof t.requestCallback&&t.requestCallback(i),i},t.deprecate=(e,t,a,r,i)=>{Object.defineProperty(e,t,{get:()=>(console.warn(`\`${r}\` will be removed in a near future release, use \`${i}\` instead.`),a)})};const i=a(206);t.lastUpdateCheck=0,t.checkForUpdates=()=>!process.env.YTDL_NO_UPDATE&&!i.version.startsWith("0.0.0-")&&Date.now()-t.lastUpdateCheck>=432e5?(t.lastUpdateCheck=Date.now(),r("https://api.github.com/repos/fent/node-ytdl-core/releases/latest",{headers:{"User-Agent":"ytdl-core"}}).text().then((e=>{JSON.parse(e).tag_name!==`v${i.version}`&&console.warn('[33mWARNING:[0m ytdl-core is out of date! Update with "npm install ytdl-core@latest".')}),(e=>{console.warn("Error checking for updates:",e.message),console.warn("You can disable this check by setting the `YTDL_NO_UPDATE` env variable.")}))):null},685:e=>{"use strict";e.exports=require("http")},687:e=>{"use strict";e.exports=require("https")},477:e=>{"use strict";e.exports=require("querystring")},781:e=>{"use strict";e.exports=require("stream")},576:e=>{"use strict";e.exports=require("string_decoder")},512:e=>{"use strict";e.exports=require("timers")},206:e=>{"use strict";e.exports=JSON.parse('{"name":"ytdl-core","description":"YouTube video downloader in pure javascript.","keywords":["youtube","video","download"],"version":"4.9.1","repository":{"type":"git","url":"git://github.com/fent/node-ytdl-core.git"},"author":"fent <fentbox@gmail.com> (https://github.com/fent)","contributors":["Tobias Kutscha (https://github.com/TimeForANinja)","Andrew Kelley (https://github.com/andrewrk)","Mauricio Allende (https://github.com/mallendeo)","Rodrigo Altamirano (https://github.com/raltamirano)","Jim Buck (https://github.com/JimmyBoh)"],"main":"./lib/index.js","types":"./typings/index.d.ts","files":["lib","typings"],"scripts":{"test":"nyc --reporter=lcov --reporter=text-summary npm run test:unit","test:unit":"mocha --ignore test/irl-test.js test/*-test.js --timeout 4000","test:irl":"mocha --timeout 16000 test/irl-test.js","lint":"eslint ./","lint:fix":"eslint --fix ./","lint:typings":"tslint typings/index.d.ts","lint:typings:fix":"tslint --fix typings/index.d.ts"},"dependencies":{"m3u8stream":"^0.8.3","miniget":"^4.0.0","sax":"^1.1.3"},"devDependencies":{"@types/node":"^13.1.0","assert-diff":"^3.0.1","dtslint":"^3.6.14","eslint":"^6.8.0","mocha":"^7.0.0","muk-require":"^1.2.0","nock":"^13.0.4","nyc":"^15.0.0","sinon":"^9.0.0","stream-equal":"~1.1.0","typescript":"^3.9.7"},"engines":{"node":">=10"},"license":"MIT"}')}},t={},function a(r){var i=t[r];if(void 0!==i)return i.exports;var s=t[r]={exports:{}};return e[r].call(s.exports,s,s.exports,a),s.exports}(270);var e,t}));